import"./index-P7FQh7om.js";const u="https://cooked-mirage-crayon.glitch.me",_=async(t,e={})=>{try{const o=await fetch(`${u}${t}`,e);if(!o.ok)throw new Error(o.status);return await o.json()}catch(o){console.error(`Ошибка запроса ${o}`)}},f=t=>_(`/api/products/category/${t}`),h=t=>_(`/api/products/list/${t.join(",")}`),b=async(t,e)=>_("/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({storeId:t,products:e})}),v=t=>{const e=document.createElement("div");e.classList.add("order-message");const o=document.createElement("p");o.classList.add("order-message__text"),o.textContent=`Ваш заказ оформлен, номер ${t}. Вы можете забрать его завтра после 12:00`;const c=document.createElement("button");return c.classList.add("order-message__close-button"),c.textContent="Закрыть",e.append(o,c),c.addEventListener("click",()=>{e.remove()}),e},C=t=>{const e=document.createElement("li");return e.classList.add("store__item"),e.innerHTML=`
    <article class="store__product product">
       <img class="product__image" src="${u}${t.photoUrl}" alt="${t.name}" width="388" height="261"/>
     <h3 class="product__title">${t.name}</h3>
     <p class="product__price">${t.price}&nbsp;₽</p>
     <button class="product__btn-add-cart" data-id=${t.id}>Заказать</button>
    </article>`,e},L=(t,e)=>{e.textContent="",t.forEach(o=>{const c=C(o);e.append(c)})},y=(t,e,o)=>{t.textContent="",o.forEach(({id:c,photoUrl:s,name:a,price:r})=>{const i=e.find(S=>S.id===c);if(!i)return;const m=document.createElement("li");m.classList.add("modal__cart-item"),m.innerHTML=`
      <img class="modal__cart-item-image" src="${u}${s}" alt="${a}" />

        <h3 class="modal__cart-item-title">${a}</h3>

        <div class="modal__cart-item-count">
          <button class="modal__btn modal__minus" data-id=${c}>-</button>
          <span class="modal__count">${i.count}</span>
          <button class="modal__btn modal__plus" data-id=${c}>+</button>
        </div>

      <p class="modal__cart-item-price">${r*i.count}</p>
    `,t.append(m)})},I=document.querySelector(".store__cart-button"),$=I.querySelector(".store__cart-cnt"),n=document.querySelector(".modal-overlay"),d=document.querySelector(".modal__cart-items");document.querySelector(".modal-overlay_close-button");const p=document.querySelector(".modal__cart-form"),E=document.querySelector(".modal__cart-price"),x=(t,e)=>t.reduce((o,c)=>{const s=e.find(a=>a.id===c.id);return o+s.price*c.count},0),l=()=>{const t=JSON.parse(localStorage.getItem("cartItems")||"[]");$.textContent=t.length};l();const O=t=>{const e=JSON.parse(localStorage.getItem("cartItems")||"[]"),o=e.find(c=>c.id===t);o?o.count+=1:e.push({id:t,count:1}),localStorage.setItem("cartItems",JSON.stringify(e)),l()},g=(t,e)=>{const o=JSON.parse(localStorage.getItem("cartItems")||"[]"),c=o.findIndex(s=>s.id===t);if(c!==-1){o[c].count+=e,o[c].count<=0&&o.splice(c,1),localStorage.setItem("cartItems",JSON.stringify(o));const s=JSON.parse(localStorage.getItem("cartProductDetails")||"[]");l(),y(d,o,s)}};I.addEventListener("click",async()=>{n.style.display="flex";const t=JSON.parse(localStorage.getItem("cartItems")||"[]"),e=t.map(s=>s.id);if(!e.length){d.textContent="";const s=document.createElement("li");s.textContent="Корзина пуста",d.append(s);return}const o=await h(e);localStorage.setItem("cartProductDetails",JSON.stringify(o)),y(d,t,o);const c=x(t,o);E.innerHTML=`${c}&nbsp;₽`});n.addEventListener("click",({target:t})=>{(t===n||t.closest(".modal-overlay_close-button"))&&(n.style.display="none")});d.addEventListener("click",({target:t})=>{if(t.classList.contains("modal__plus")){const e=t.dataset.id;g(e,1)}if(t.classList.contains("modal__minus")){const e=t.dataset.id;g(e,-1)}});p.addEventListener("submit",async t=>{t.preventDefault();const e=p.store.value,c=JSON.parse(localStorage.getItem("cartItems")||"[]").map(({id:a,count:r})=>({id:a,quantity:r})),{orderId:s}=await b(e,c);localStorage.removeItem("cartItems"),localStorage.removeItem("cartProductDetails"),document.body.append(v(s)),n.style.display="none",l()});const P=()=>{const t=document.querySelectorAll(".store__category-button"),e=document.querySelector(".store__list"),o=async({target:c})=>{const s=c.textContent.trim();t.forEach(r=>{r.classList.remove("store__category-button_active")}),c.classList.add("store__category-button_active");const a=await f(s);L(a,e)};t.forEach(c=>{c.addEventListener("click",o),c.classList.contains("store__category-button_active")&&o({target:c})}),e.addEventListener("click",({target:c})=>{const s=c.dataset.id;O(s)})};P();
